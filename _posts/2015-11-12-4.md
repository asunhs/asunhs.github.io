---
layout: post
title: "Google Apps Script (2)"
published: false
tags: [apps script, google, oauth]
---

[Google Apps Script](https://script.google.com)는 구글의 여러 웹앱 (Docs, Sheets, Forms, Calendar, Contact, ...)에 부가기능을 적용하거나 Web으로 접근 가능한 Services를 연계할 수 있는 기술이다. Javascript 기반 코드로 동작하며 Apps Script를 동작하기 위한 서버환경을 기본적으로 제공하고 있으며 현재 **무료**로 서비스 되고 있다.

이전글 보기
- [Google Apps Script (2)](/3)


# Execution API



# OAuth 2.0 Setting


```javascript
// Your Client ID can be retrieved from your project in the Google
// Developer Console, https://console.developers.google.com
var CLIENT_ID = '<YOUR_CLIENT_ID>';

var SCOPES = [
    'https://www.googleapis.com/auth/drive',
    'https://www.googleapis.com/auth/spreadsheets'
];
```

[OAuth scopes](https://developers.google.com/apps-script/execution/rest/v1/scripts/run#authorization)


```javascript
/**
 * Check if current user has authorized this application.
 */
function checkAuth() {
    gapi.auth.authorize({
        'client_id': CLIENT_ID,
        'scope': SCOPES.join(' '),
        'immediate': true
    }, handleAuthResult);
}

/**
 * Handle response from authorization server.
 *
 * @param {Object} authResult Authorization result.
 */
function handleAuthResult(authResult) {
    var authorizeDiv = document.getElementById('authorize-div');

    if (authResult && !authResult.error) {
        // Hide auth UI, then load client library.
        authorizeDiv.style.display = 'none';

        // <YOUR_WORKS_AFTER_AUTHORIZED >
        callScriptFunction('getTotals');
    } else {
        // Show auth UI, allowing the user to initiate authorization by
        // clicking authorize button.
        authorizeDiv.style.display = 'inline';
    }
}
```


```javascript
/**
 * Calls an Apps Script function to list the folders in the user's
 * root Drive folder.
 */
function callScriptFunction(method, params) {
    // ID of the script to call. Acquire this from the Apps Script editor,
    // under Publish > Deploy as API executable.
    var scriptId = "<YOUR_SCRIPT_ID>";

    // Create execution request.
    var request = {
        'function': method,
        'parameters': params
    };

    // Make the request.
    var op = gapi.client.request({
        'root': 'https://script.googleapis.com',
        'path': 'v1/scripts/' + scriptId + ':run',
        'method': 'POST',
        'body': request
    });

    // Log the results of the request.
    op.execute(function(resp) {
        if (resp.error && resp.error.status) {
            // The API encountered a problem before the script started executing.
            console.log('Error calling API: ' + JSON.stringify(resp, null, 2));
        } else if (resp.error) {
            // The API executed, but the script returned an error.
            var error = resp.error.details[0];
            console.log('Script error! Message: ' + error.errorMessage);
        } else {
            // Here, the function returns an array of strings.
            console.log(resp.response.result);
        }
    });
}
```

```html
    <script src="app.js"></script>
    <script src="https://apis.google.com/js/client.js?onload=checkAuth"></script>
```